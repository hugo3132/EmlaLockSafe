<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EmlaLockSafe: EmlaLockSafe</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EmlaLockSafe
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">EmlaLockSafe </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Overview">Overview</a></li>
<li class="level1"><a href="#secConfiguration">Configuration</a><ul><li class="level2"><a href="#subWifiConfigurationServer">WiFi Configuration Server</a></li>
<li class="level2"><a href="#subMainConfigurationServer">Main Configuration Server</a></li>
</ul>
</li>
<li class="level1"><a href="#secLockstate">Lockstate</a></li>
<li class="level1"><a href="#secEmlaLockApi">EmlaLock API</a></li>
<li class="level1"><a href="#secViews">Views</a><ul><li class="level2"><a href="#subPreferencesMenu">Preferences Menu</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p >Documentation for the software of the EmlaLockSafe which can be found under <a href="https://github.com/hugo3132/EmlaLockSafe">https://github.com/hugo3132/EmlaLockSafe</a>.</p>
<p ><a href="https://github.com/hugo3132/EmlaLockSafe/blob/master/hardware/pictures/safe.png"><div class="image">
<img src="https://raw.githubusercontent.com/hugo3132/EmlaLockSafe/master/hardware/pictures/safe.png" alt="" height="300px"/>
</div>
 </a></p>
<h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p >The EmlaLockSafe uses an ESP32 processor board to open the attached safe dependent on your session on <a href="https://www.emlalock.com">emlalock.com</a>. The software running on the EPS32 is speparated into different parts which are described in the following sections.</p>
<p >The <a class="el" href="index.html#secConfiguration">first section</a> covers the how the webservers are used to configure the software. The section <a class="el" href="index.html#secLockstate">Lockstate</a> shows how the software handles if it should open or not and what is shown on the display. The section <a class="el" href="index.html#secEmlaLockApi">EmlaLock API</a> shows how the software interacts with the API of <a href="https://www.emlalock.com">emlalock.com</a>.</p>
<p >Except of the <a class="el" href="index.html#subWifiConfigurationServer">WiFi Configuration Server</a>, everything what is displayed on the LCD is using <a class="el" href="index.html#secViews">Views</a>. A view can be what's currently displayed, a dialog or an menu. For the navigation within the views, the encoder nob can be used.</p>
<dl class="section warning"><dt>Warning</dt><dd>If the filesystem in the flash memory (SPIFFS) is accessed the interrupts must be temorarily deactivated. The class <a class="el" href="class_used_interrupts.html">UsedInterrupts</a> provides an <a class="el" href="class_used_interrupts.html#aad496f7de1b405ad5e8e1996283e87c1">attach</a> and <a class="el" href="class_used_interrupts.html#af79f25961986a8f91fa207b8381682f9">detach</a> function to temporarily deactivated the interrupts. An other option is to use the function <a class="el" href="class_used_interrupts.html#a7783d371f93af2c1c7d70c4183304047">executeWithoutInterrupts</a> which accepts a lamda expression which is executed while the interrupts are detached.</dd></dl>
<h1><a class="anchor" id="secConfiguration"></a>
Configuration</h1>
<p >The configuration is stored in the fields of the <a class="el" href="classconfiguration_1_1_configuration.html">configuration::Configuration</a> class. It automatically loads and saves all parameters to the file /configuration.txt. The filesystem is located in an SPIFFS in the ESP32's flash memory. To change the configuration two webservers are used. The first sever (see <a class="el" href="index.html#subWifiConfigurationServer">WiFi Configuration Server</a>) is always started automatically when the WiFi credentials are not complete. The second server (see <a class="el" href="index.html#subMainConfigurationServer">Main Configuration Server</a>) is automatically started if the EmlaLock API is not configured. Both servers can also be started using the <a class="el" href="index.html#subPreferencesMenu">Preferences Menu</a>. The webservers are derived <a class="el" href="classconfiguration_1_1_configuration_server_base.html">configuration::ConfigurationServerBase</a>. The base class provides the function <a class="el" href="classconfiguration_1_1_configuration_server_base.html#a27025824b06f68019d9202f1adf2e4e3">addSpiffsFileToServer()</a> which makes a file in the SPIFFS available on the webserver. In addition, jquery and the main CSS file is added.</p>
<h2><a class="anchor" id="subWifiConfigurationServer"></a>
WiFi Configuration Server</h2>
<p >The server is started as soon as the WiFi SSID or password is empty in the <a class="el" href="classconfiguration_1_1_configuration.html">configuration::Configuration</a> class. Since the WiFi credentials are not known, the ESP32 acts as access point with the SSID SafeSetup (see <a class="el" href="classconfiguration_1_1_wifi_configuration_server.html#a615859554e70e2b06a1611ecb28585fa">createAp()</a>). Additionally, a DNS server is started which resolves any request to the IP address of the ESP32. This is necessary to implemented a captive portal which automatically forwards any client which connects to the WiFi to the configuration website. If the captive portal does not work, the necessary steps are also displayed on the LCD:</p>
<p ><a href="https://github.com/hugo3132/EmlaLockSafe/blob/master/hardware/pictures/WifiSetup.jpg"><div class="image">
<img src="https://raw.githubusercontent.com/hugo3132/EmlaLockSafe/master/hardware/pictures/WifiSetup.jpg" alt="" height="300px"/>
</div>
 </a></p>
<p >The webserver (see <a class="el" href="classconfiguration_1_1_wifi_configuration_server.html#ac46fe0f0dfa7a242b6799ae3422db5cd">configureWebserver()</a>) also provides a generated text-file with all visible WiFi networks. The list is automatically updated in the <a class="el" href="classconfiguration_1_1_wifi_configuration_server.html#abcce3bc2776758a2a5e57660f9b1f0b0">loop()</a> function.</p>
<h2><a class="anchor" id="subMainConfigurationServer"></a>
Main Configuration Server</h2>
<h1><a class="anchor" id="secLockstate"></a>
Lockstate</h1>
<h1><a class="anchor" id="secEmlaLockApi"></a>
EmlaLock API</h1>
<h1><a class="anchor" id="secViews"></a>
Views</h1>
<h2><a class="anchor" id="subPreferencesMenu"></a>
Preferences Menu</h2>
<dl class="section note"><dt>Note</dt><dd>Only available when unlocked </dd></dl>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
